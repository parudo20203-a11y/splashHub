local P = game:GetService("Players").LocalPlayer;
local UIS = game:GetService("UserInputService");
local RS = game:GetService("RunService");
local WS = game:GetService("Workspace");
local HTTP = game:GetService("HttpService"); -- JSONã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ç”¨ (KILLæ©Ÿèƒ½ã§åˆ©ç”¨)

if not P then return end;

local WALK_SPEED = 32;
local FLY_SPEED = 40; 
local MAX_FAILURES = 5; 
local GRAB_DETECTION_OBJECTS = {"BodyPosition", "BodyVelocity", "BodyGyro", "AlignOrientation", "AlignPosition", "Attachment"};

local isFlying = false;
local bodyVelocity = nil;
local controlButton = nil;
local speedTextBox = nil;
local MainFrame = nil;
local anticheatBinding = nil;
local flyLoopBinding = nil;
local antiragdollBinding = nil; 
local grabDetectionConnection = nil; -- æ´ã¿æ¤œå‡ºç”¨ã®æ¥ç¶š
local isDragging = false;
local dragOffset = nil;
local failureCount = 0; 

-- é€šçŸ¥æ©Ÿèƒ½ (å¤‰æ›´ãªã—)
local function showNotification(message, color)
    local G = Instance.new("ScreenGui", P.PlayerGui);
    G.Name = "SplashHubNotify";
    -- ... [UI creation details omitted for brevity] ...
    local NF = Instance.new("Frame", G);
    NF.Size = UDim2.new(0, 300, 0, 50);
    NF.Position = UDim2.new(1, 0, 1, -50);
    NF.BackgroundColor3 = Color3.new(0.2, 0.2, 0.2);
    NF.BackgroundTransparency = 0.1;
    NF.BorderColor3 = Color3.new(0, 0, 0);
    NF.BorderSizePixel = 0;
    local T = Instance.new("TextLabel", NF);
    T.Size = UDim2.new(1, 0, 1, 0);
    T.BackgroundColor3 = Color3.new(0.2, 0.2, 0.2);
    T.BackgroundTransparency = 0.8;
    T.Text = message;
    T.TextColor3 = color or Color3.fromRGB(255, 255, 255);
    T.Font = Enum.Font.SourceSansBold;
    T.TextSize = 18;
    
    pcall(NF.TweenPosition, NF, UDim2.new(1, -310, 1, -50), "Out", "Quart", 0.3, true);
    
    spawn(function()
        wait(3);
        pcall(NF.TweenPosition, NF, UDim2.new(1, 0, 1, -50), "In", "Quart", 0.3, true);
        wait(0.3);
        if G and G.Parent then pcall(G.Destroy, G) end;
    end);
end;


-- â˜… æ–°è¦è¿½åŠ : æ•µãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’KILLã™ã‚‹ãƒ€ãƒŸãƒ¼RemoteEventå‘¼ã³å‡ºã—
local function sendKillSignal(targetPlayer)
    if not targetPlayer then return end

    -- ä¸€èˆ¬çš„ãªKICK/BAN/KILLã®RemoteEventåã‚’æ¨æ¸¬ã—ã¦å‘¼ã³å‡ºã™ (ã‚²ãƒ¼ãƒ ã«ã‚ˆã£ã¦ç•°ãªã‚‹)
    local eventNames = {"KickPlayer", "BanPlayer", "AdminEvent", "KillPlayer"};
    
    showNotification("ğŸš¨ æ¤œå‡ºã•ã‚ŒãŸæ”»æ’ƒè€… (" .. targetPlayer.Name .. ") ã«KILLä¿¡å·ã‚’é€ä¿¡ã—ã¾ã™...", Color3.fromRGB(255, 0, 0));

    for _, eventName in pairs(eventNames) do
        local remote = P:FindFirstChild(eventName) or WS:FindFirstChild(eventName) or Instance.new("RemoteEvent", WS);
        remote.Name = eventName; -- ä»®ã«ä½œæˆã—ã€å‘¼ã³å‡ºã—ã‚’è©¦ã¿ã‚‹

        local success, err = pcall(function()
            -- æ”»æ’ƒè€…ã®UserIdã‚„Nameã‚’ã‚·ã‚°ãƒŠãƒ«ã¨ã—ã¦é€ä¿¡
            remote:FireServer(targetPlayer.UserId, targetPlayer.Name, "HaxDetection");
        end)
        
        if not success then
            -- RemoteEventãŒãªã„å ´åˆã‚„ã€ä¸æ­£ãªå¼•æ•°ã®å ´åˆã¯ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ãŒç„¡è¦–
        end
    end
    
    -- æ”»æ’ƒè€…ã®ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚’ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§ç ´å£Š (ãƒ­ãƒ¼ã‚«ãƒ«å´ã®ã¿æœ‰åŠ¹)
    if targetPlayer.Character and targetPlayer.Character:FindFirstChildOfClass("Humanoid") then
        pcall(function() targetPlayer.Character:FindFirstChildOfClass("Humanoid").Health = 0 end);
    end
end

-- â˜… æ–°è¦è¿½åŠ : æ´ã¿ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®æ¤œçŸ¥ã¨KILLãƒ­ã‚¸ãƒƒã‚¯
local function setupGrabDetection(rootPart)
    if grabDetectionConnection and grabDetectionConnection.Connected then
        grabDetectionConnection:Disconnect();
    end

    grabDetectionConnection = rootPart.ChildAdded:Connect(function(child)
        for _, name in pairs(GRAB_DETECTION_OBJECTS) do
            if child.ClassName == name and child.Parent == rootPart then
                -- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒæ´ã¿ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æŒ¿å…¥ã—ãŸã‹ãƒã‚§ãƒƒã‚¯
                local creator = child:FindFirstChild("CreatorTag") or child:FindFirstChild("owner") -- æŒ¿å…¥è€…ç‰¹å®šã‚’è©¦ã¿ã‚‹
                local attacker = nil;
                
                if creator and creator.Value then
                    local player = game:GetService("Players"):GetPlayerByUserId(creator.Value)
                    if player then attacker = player end
                end

                if not attacker then
                    -- creatorã‚¿ã‚°ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã¯ã€è¿‘ãã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’æ¢ã™ãªã©ã®ãƒ’ãƒ¥ãƒ¼ãƒªã‚¹ãƒ†ã‚£ãƒƒã‚¯ãŒå¯èƒ½ã ãŒè¤‡é›‘ãªãŸã‚ã€ã“ã“ã§ã¯å˜ç´”ã«é€šçŸ¥
                end
                
                if attacker and attacker ~= P then
                    showNotification("â›” æ´ã¿ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ¿å…¥ (" .. name .. ") ã‚’æ¤œå‡ºï¼è„±å‡ºï¼†KILLã‚’è©¦ã¿ã¾ã™ã€‚", Color3.fromRGB(255, 50, 50));
                    sendKillSignal(attacker); -- æ”»æ’ƒè€…ã‚’KILL
                else
                    showNotification("â›” æ´ã¿ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ¿å…¥ (" .. name .. ") ã‚’æ¤œå‡ºï¼è„±å‡ºã‚’è©¦ã¿ã¾ã™ã€‚", Color3.fromRGB(255, 150, 0));
                end
                
                -- å³åº§ã«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å‰Šé™¤ã—ã¦è„±å‡º
                pcall(child.Destroy, child);
            end
        end
    end);
end

-- æ•µã‚¹ã‚¯ãƒªãƒ—ãƒˆç„¡åŠ¹åŒ–æ©Ÿèƒ½ (å¤‰æ›´ãªã—)
local function disableTargetScript()
    local playerScripts = P:FindFirstChild("PlayerScripts");
    if not playerScripts then return end

    local targetScript = playerScripts:FindFirstChild("CharacterAndBeamMove");
    
    if targetScript then
        local success, _ = pcall(function() targetScript:Destroy(); end)
        if success then
            showNotification("æ•µã‚¹ã‚¯ãƒªãƒ—ãƒˆ (CharacterAndBeamMove) ã‚’ç„¡åŠ¹åŒ–ã—ã¾ã—ãŸã€‚", Color3.fromRGB(0, 255, 0));
        else
            pcall(function() targetScript.Disabled = true end);
            showNotification("æ•µã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å‰Šé™¤ã«å¤±æ•—ã€‚ç„¡åŠ¹åŒ–ã‚’è©¦ã¿ã¾ã—ãŸã€‚", Color3.fromRGB(255, 100, 100));
        end
    else
        showNotification("æ•µã‚¹ã‚¯ãƒªãƒ—ãƒˆ (CharacterAndBeamMove) ã¯è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚", Color3.fromRGB(150, 150, 150));
    end
end

-- é£›è¡Œåœæ­¢ (å®‰å…¨ãªã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—)
local function stopFlying()
    if not isFlying then return end;
    isFlying = false;
    failureCount = 0; 
    
    if anticheatBinding then pcall(RS.UnbindFromRenderStep, RS, "AntiAC"); anticheatBinding = nil end;
    
    local H = P.Character and P.Character:FindFirstChildOfClass("Humanoid");
    if H and H.Parent then pcall(function() H.WalkSpeed = WALK_SPEED end) end;
    
    if bodyVelocity and bodyVelocity.Parent then pcall(bodyVelocity.Destroy, bodyVelocity); bodyVelocity = nil end;
    
    if controlButton then pcall(function() controlButton.Text = "SplashHub: é£›è¡Œåˆ‡ã‚Šæ›¿ãˆ" end) end;
    showNotification("SplashHub: é£›è¡Œ OFF", Color3.fromRGB(255, 100, 100));
end;

-- é£›è¡Œé–‹å§‹ (å¤‰æ›´ãªã—)
local function startFlying()
    if isFlying then return end;
    
    local H = P.Character and P.Character:FindFirstChildOfClass("Humanoid");
    local Root = P.Character and P.Character:FindFirstChild("HumanoidRootPart");
    
    if not H or not Root or not Root.Parent then showNotification("ã‚¨ãƒ©ãƒ¼: ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚", Color3.fromRGB(255, 0, 0)); return end;
    
    isFlying = true;
    pcall(function() H.WalkSpeed = 0 end)
    
    bodyVelocity = Root:FindFirstChildOfClass("BodyVelocity") or Instance.new("BodyVelocity");
    bodyVelocity.MaxForce = Vector3.new(1, 1, 1) * 9e9;
    bodyVelocity.P = 1000;
    pcall(function() bodyVelocity.Parent = Root end)
    
    -- ã‚¢ãƒ³ãƒãƒãƒ¼ãƒˆ & é€Ÿåº¦ãƒªã‚»ãƒƒãƒˆå¯¾ç­–ãƒ«ãƒ¼ãƒ—
    anticheatBinding = RS:BindToRenderStep("AntiAC", Enum.RenderPriority.Camera.Value, function()
        if not P.Character or not Root or not Root.Parent or not H or not H.Parent then 
            stopFlying(); 
            return 
        end;
        
        -- WalkSpeedãƒã‚§ãƒƒã‚¯
        if H.WalkSpeed ~= 0 then
            -- ... [WalkSpeed check logic omitted for brevity] ...
            pcall(function() H.WalkSpeed = 0 end) 
            
            if H.WalkSpeed ~= 0 then
                failureCount = failureCount + 1;
                
                if failureCount >= MAX_FAILURES then
                    showNotification("ã‚¢ãƒ³ãƒãƒãƒ¼ãƒˆæ¤œå‡ºã€‚å®‰å…¨ã®ãŸã‚é£›è¡Œã‚’è§£é™¤ã—ã¾ã™ã€‚", Color3.fromRGB(255, 50, 50));
                    stopFlying();
                    return
                end
            end
        else
            failureCount = 0; 
        end
        
        -- BodyVelocityã®å†æŒ¿å…¥
        if bodyVelocity and not bodyVelocity.Parent then
            pcall(function() bodyVelocity.Parent = Root end);
        end;
    end);
    
    if controlButton then pcall(function() controlButton.Text = "SplashHub: é£›è¡Œåˆ‡ã‚Šæ›¿ãˆ" end) end;
    showNotification("SplashHub: é£›è¡Œ ON", Color3.fromRGB(100, 255, 100));
end;

-- é£›è¡Œç§»å‹•å‡¦ç† (ã‚«ãƒ¡ãƒ©æ–¹å‘) (å¤‰æ›´ãªã—)
local function updateFlyMovement()
    -- ... [Movement logic omitted for brevity] ...
    if not isFlying or not P.Character or not P.Character:FindFirstChildOfClass("Humanoid") then stopFlying(); return end;
    if not bodyVelocity or not bodyVelocity.Parent then stopFlying(); return end;

    local C = WS.CurrentCamera;
    if not C then return end;
    local CF_ = C.CFrame;
    local mV = Vector3.new(0, 0, 0);
    
    if UIS:IsKeyDown(Enum.KeyCode.W) then mV = mV + CF_.LookVector end;
    if UIS:IsKeyDown(Enum.KeyCode.S) then mV = mV - CF_.LookVector end;
    if UIS:IsKeyDown(Enum.KeyCode.A) then mV = mV - CF_.RightVector end;
    if UIS:IsKeyDown(Enum.KeyCode.D) then mV = mV + CF_.RightVector end;
    if UIS:IsKeyDown(Enum.KeyCode.Space) then mV = mV + Vector3.new(0, 1, 0) end;
    if UIS:IsKeyDown(Enum.KeyCode.LeftShift) or UIS:IsKeyDown(Enum.KeyCode.RightShift) then mV = mV - Vector3.new(0, 1, 0) end;
    
    if mV.Magnitude > 0 then
        pcall(function() bodyVelocity.Velocity = mV.unit * FLY_SPEED end);
    else
        pcall(function() bodyVelocity.Velocity = Vector3.new(0, 0, 0) end);
    end;
end;

-- ãƒ©ã‚°ãƒ‰ãƒ¼ãƒ«ç„¡åŠ¹åŒ–å‡¦ç† (å¸¸æ™‚å®Ÿè¡Œ)
local function updateAntiRagdoll()
    local H = P.Character and P.Character:FindFirstChildOfClass("Humanoid");
    if H and H.Parent then 
        -- PlatformStandãŒæœ‰åŠ¹ã«ãªã£ã¦ã„ãŸã‚‰å³åº§ã«ç„¡åŠ¹åŒ– (ç·Šæ€¥è„±å‡º)
        if H.PlatformStand == true then
             pcall(function() H.PlatformStand = false; end);
             showNotification("âš¡ PlatformStandã‚’å³åº§ã«è§£é™¤ã—ã¾ã—ãŸï¼", Color3.fromRGB(255, 255, 0));
        end
        pcall(function() H.PlatformStand = false end);
    end;
end;

-- UI/ãƒ‰ãƒ©ãƒƒã‚°æ©Ÿèƒ½ (çœç•¥)
local function startDrag(input) isDragging = true; dragOffset = input.Position - Vector2.new(MainFrame.AbsolutePosition.X, MainFrame.AbsolutePosition.Y); UIS.MouseIconEnabled = false; end;
local function updateDrag(input) if isDragging and input.UserInputType == Enum.UserInputType.MouseMovement then MainFrame.Position = UDim2.new(0, input.Position.X - dragOffset.X, 0, input.Position.Y - dragOffset.Y); end; end;
local function endDrag(input) if input.UserInputType == Enum.UserInputType.MouseButton1 then isDragging = false; dragOffset = nil; UIS.MouseIconEnabled = true; end; end;

local function createUI()
    -- ... [UI creation details omitted for brevity] ...
    local existingGui = P.PlayerGui:FindFirstChild("SplashHubControlGui");
    if existingGui then existingGui:Destroy() end;

    local G = Instance.new("ScreenGui");
    G.Name = "SplashHubControlGui";
    G.Parent = P.PlayerGui;
    
    MainFrame = Instance.new("Frame");
    MainFrame.Name = "MainFrame";
    MainFrame.Size = UDim2.new(0, 450, 0, 40);
    MainFrame.Position = UDim2.new(0, 10, 0, 10);
    MainFrame.BackgroundColor3 = Color3.fromRGB(255, 255, 255);
    MainFrame.BackgroundTransparency = 0.5;
    MainFrame.Parent = G;
    
    controlButton = Instance.new("TextButton");
    controlButton.Name = "FlyToggle";
    controlButton.Size = UDim2.new(0, 150, 1, 0);
    controlButton.Position = UDim2.new(0, 0, 0, 0);
    controlButton.BackgroundColor3 = Color3.fromRGB(0, 150, 255);
    controlButton.TextColor3 = Color3.new(1, 1, 1);
    controlButton.Text = "SplashHub: é£›è¡Œåˆ‡ã‚Šæ›¿ãˆ";
    controlButton.Font = Enum.Font.SourceSansBold;
    controlButton.TextSize = 18;
    controlButton.ZIndex = 2; 
    controlButton.Parent = MainFrame;

    local speedLabel = Instance.new("TextLabel");
    speedLabel.Name = "SpeedLabel";
    speedLabel.Size = UDim2.new(0, 80, 1, 0);
    speedLabel.Position = UDim2.new(0, 150, 0, 0); 
    speedLabel.BackgroundTransparency = 1;
    speedLabel.TextColor3 = Color3.new(0, 0, 0);
    speedLabel.Text = "é€Ÿåº¦èª¿æ•´:";
    speedLabel.Font = Enum.Font.SourceSansBold;
    speedLabel.TextSize = 18;
    speedLabel.ZIndex = 2; 
    speedLabel.Parent = MainFrame;
    
    speedTextBox = Instance.new("TextBox");
    speedTextBox.Name = "SpeedInput";
    speedTextBox.Size = UDim2.new(0, 70, 0.8, 0);
    speedTextBox.Position = UDim2.new(0, 230, 0.1, 0); 
    speedTextBox.BackgroundColor3 = Color3.new(1, 1, 1);
    speedTextBox.BackgroundTransparency = 0.3;
    speedTextBox.TextColor3 = Color3.new(0, 0, 0);
    speedTextBox.Text = tostring(FLY_SPEED);
    speedTextBox.Font = Enum.Font.SourceSansBold;
    speedTextBox.TextSize = 18;
    speedTextBox.ZIndex = 3; 
    speedTextBox.Parent = MainFrame;
    
    controlButton.MouseButton1Click:Connect(function() if isFlying then stopFlying() else startFlying() end end);
    speedTextBox.FocusLost:Connect(function(enterPressed)
        if enterPressed or not enterPressed then updateSpeed() end
    end);
    MainFrame.InputBegan:Connect(function(i) if i.UserInputType == Enum.UserInputType.MouseButton1 then startDrag(i) end end);
    UIS.InputChanged:Connect(updateDrag);
    UIS.InputEnded:Connect(endDrag);
end;


-- ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼åˆæœŸè¨­å®š
local function setupCharacter(character)
    local H = character:FindFirstChildOfClass("Humanoid");
    if H then pcall(function() H.WalkSpeed = WALK_SPEED end) end;
    if isFlying then stopFlying() end;
    
    local Root = character:FindFirstChild("HumanoidRootPart");
    if Root then setupGrabDetection(Root) end; -- â˜… æ´ã¿æ¤œå‡ºã®åˆæœŸè¨­å®š
end;

if P.Character then setupCharacter(P.Character) end;
P.CharacterAdded:Connect(setupCharacter);

-- ãƒ¡ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ—æ¥ç¶š
if not flyLoopBinding then
    flyLoopBinding = RS:BindToRenderStep("FlyMovement", Enum.RenderPriority.Character.Value, updateFlyMovement);
end;

if not antiragdollBinding then
    antiragdollBinding = RS:BindToRenderStep("AntiRagdoll", Enum.RenderPriority.Camera.Value - 1, updateAntiRagdoll);
end;

-- æœ€åˆã«æ•µã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ç„¡åŠ¹åŒ–ã™ã‚‹
disableTargetScript();

createUI();
